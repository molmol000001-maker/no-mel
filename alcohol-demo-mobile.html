<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>飲酒管理（PWAデモ）</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icons/icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    body { background: linear-gradient(to bottom, #f8fafc, #eef2f7); }
  </style>
</head>
<body class="text-slate-900">
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const gramsOfAlcohol = (abvPct, ml) => ml * (abvPct/100) * 0.8;
    const fmtTime = (ts) => { const d = new Date(ts); return (String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")); };
    const levelFromC = (C) => { const t=[0.1,0.2,0.3,0.4,0.5,Infinity]; for(let i=0;i<t.length;i++){ if(C<=t[i]) return i; } return 5; };
    const HYDRATION_INTERVAL_MIN = 60;
    const C_FOR_LEVEL = {0:0.1,1:0.2,2:0.3,3:0.4,4:0.5,5:0.6};
    const COCKTAIL_DEFAULT_ML = 150;
    const DRINKS = {
      beer:{ name:"ビール", avgAbv:5, options:[{label:"350ml",ml:350},{label:"500ml",ml:500}] },
      wine:{ name:"ワイン", avgAbv:12, options:[{label:"グラス(120ml)",ml:120}] },
      gin:{ name:"ジン", avgAbv:40, options:[{label:"",ml:30}], simpleAdd:true },
      vodka:{ name:"ウォッカ", avgAbv:40, options:[{label:"",ml:30}], simpleAdd:true },
      sake:{ name:"日本酒", avgAbv:15, options:[{label:"お猪口(60ml)",ml:60},{label:"一合(180ml)",ml:180}] },
      shochu:{ name:"焼酎", avgAbv:25, options:[{label:"",ml:90}], simpleAdd:true },
      whisky:{ name:"ウイスキー", avgAbv:40, options:[{label:"",ml:30}], simpleAdd:true },
      chuhi:{ name:"酎ハイ", avgAbv:7, options:[{label:"350ml",ml:350},{label:"500ml",ml:500}], allowPercent:true, percentRange:{min:3,max:12,step:0.5} },
      cocktail:{ name:"カクテル", avgAbv:20, options:[{label:"弱め（10度前後）",abv:10},{label:"レギュラー（20度前後）",abv:20},{label:"強め（30度前後以上）",abv:30}] },
      other:{ name:"その他", avgAbv:5, options:[{label:"100ml",ml:100}], allowPercent:true, percentRange:{min:0,max:96,step:0.5} },
    };
    const ORDER = ["beer","wine","gin","vodka","sake","shochu","whisky","chuhi","cocktail","other"];
    function Badge({level}){ const labels=["0 素面","1 ほろ","2 良い感じ","3 注意","4 強い酔い","5 危険域"]; const cls=["bg-gray-200 text-gray-800","bg-green-200 text-green-800","bg-emerald-200 text-emerald-800","bg-amber-200 text-amber-900","bg-orange-300 text-orange-900","bg-red-500 text-white"]; return <span className={`px-2.5 py-1 rounded-2xl text-xs font-semibold ${cls[level]}`}>{labels[level]}</span>; }
    function App(){
      const [weightKg,setWeightKg]=useState(Number(localStorage.getItem("alc_weightKg")||75));
      const [age,setAge]=useState(Number(localStorage.getItem("alc_age")||35));
      const [sex,setSex]=useState(localStorage.getItem("alc_sex")||"male");
      const r=useMemo(()=>sex==="male"?0.68:sex==="female"?0.55:0.62,[sex]);
      const burnRate=useMemo(()=>{let v=sex==="male"?7.2:sex==="female"?6.8:7.0; if(age<30)v+=0.2; else if(age>=60)v-=0.2; return Math.max(3,Math.min(12,Number(v.toFixed(1))))},[sex,age]);
      const limitLevel=3;
      const [A_g,setAg]=useState(Number(localStorage.getItem("alc_Ag")||0));
      const [lastTs,setLastTs]=useState(Number(localStorage.getItem("alc_lastTs")||Date.now()));
      const [history,setHistory]=useState(()=>{const v=localStorage.getItem("alc_hist"); return v?JSON.parse(v):[];});
      const [lastWaterTs,setLastWaterTs]=useState(Number(localStorage.getItem("alc_lastWater")||0));
      const [tab,setTab]=useState("home");
      const [cat,setCat]=useState("beer");
      const [optionIdx,setOptionIdx]=useState(0);
      const [percent,setPercent]=useState("");
      useEffect(()=>localStorage.setItem("alc_weightKg",String(weightKg)),[weightKg]);
      useEffect(()=>localStorage.setItem("alc_age",String(age)),[age]);
      useEffect(()=>localStorage.setItem("alc_sex",String(sex)),[sex]);
      useEffect(()=>localStorage.setItem("alc_Ag",String(A_g)),[A_g]);
      useEffect(()=>localStorage.setItem("alc_lastTs",String(lastTs)),[lastTs]);
      useEffect(()=>localStorage.setItem("alc_hist",JSON.stringify(history)),[history]);
      useEffect(()=>localStorage.setItem("alc_lastWater",String(lastWaterTs)),[lastWaterTs]);
      useEffect(()=>{const id=setInterval(()=>{const now=Date.now(); const dt_h=Math.max(0,(now-lastTs)/3600000); const newA=Math.max(0,A_g-burnRate*dt_h); setAg(newA); setLastTs(now);},60000); return()=>clearInterval(id);},[A_g,lastTs,burnRate]);
      const cfg=DRINKS[cat]; const cur=cfg.options[Math.max(0,Math.min(optionIdx,cfg.options.length-1))]; const baseAbv=(cur&&cur.abv!=null)?cur.abv:(cfg.allowPercent?Number(percent || cfg.avgAbv):cfg.avgAbv)
    </script>
</body>
</html>
